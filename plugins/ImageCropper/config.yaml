id: ImageCropper
name: Image Cropper
description: <__trans phrase="Allows users to define a set of thumbnail prototypes that others can easily generate using a drag-and-drop image cropping tool.">
version: 1.0.24
schema_version: 8
l10n_class: ImageCropper::L10N
author_name: naoaki.onozaki
author_link: http://www.zelazny.mydns.jp/
plugin_link: https://github.com/naoaki011/mt-plugin-imagecropper

callbacks:
    MT::App::CMS::init_app: $ImageCropper::ImageCropper::Plugin::init_app
    MT::Asset::Image::post_remove: $ImageCropper::ImageCropper::Plugin::post_remove_asset

upgrade_functions:
    cropper_key_change:
        version_limit: 6
        priority: 1
        updater:
            type: thumbnail_prototype_map
            label: Updating Prototype Map keys...
            code: $ImageCropper::ImageCropper::Upgrade::prototype_map_key
    cropper_abbrev_tables:
        version_limit: 8
        priority: 5
        code: $ImageCropper::ImageCropper::Upgrade::AbbrevTables::run

config_settings:
  DefaultCroppedImageText: 
    default: 'Created by "Image Cropper"'

blog_config_template: tmpl/blog_config.tmpl

settings:
  cropped_text: 
    default: ''
    scope: blog
  default_compress:
    default: '7'
    scope: blog
  annotate_fontfamily:
    default: 'Helvetica'
    scope: blog
  annotate_fontsize:
    default: '10'
    scope: blog
tags:
  block:
    CroppedAsset: $ImageCropper::ImageCropper::Plugin::hdlr_cropped_asset
  function:
    ScaleThumbnailURL: $ImageCropper::ImageCropper::Plugin::hdlr_scale_thumbnail
    FillThumbnailURL: $ImageCropper::ImageCropper::Plugin::hdlr_fill_thumbnail
    CropThumbnailURL: $ImageCropper::ImageCropper::Plugin::hdlr_crop_thumbnail
    PrototypeVar: $ImageCropper::ImageCropper::Plugin::hdlr_var_prototype
object_types:
    thumbnail_prototype: ImageCropper::Prototype
    thumbnail_prototype_map: ImageCropper::PrototypeMap
applications:
  cms:
    menus: 
      prefs:image_cropper:
        label: Thumbnail Prototypes
        mode: list_prototypes
        order: 500
        permission: edit_templates
        view: blog
      design:image_cropper:
        label: Thumbnail Prototypes
        mode: list_prototypes
        order: 500
        permission: edit_templates
        view:
          - blog
          - website
        condition: $ImageCropper::ImageCropper::Util::is_mt5
      design:crop_prototypes:
        label: Crop Prototypes
        mode: list
        args:
          _type: thumbnail_prototype
        order: 500
        permission: edit_templates
        view:
          - blog
          - website
        condition: $ImageCropper::ImageCropper::Util::is_illiad
    methods:
      list_prototypes: $ImageCropper::ImageCropper::Plugin::list_prototypes
      edit_prototype: $ImageCropper::ImageCropper::Plugin::edit_prototype
      delete_prototype: $ImageCropper::ImageCropper::Plugin::del_prototype
      save_prototype: $ImageCropper::ImageCropper::Plugin::save_prototype
      manage_thumbnails: $ImageCropper::ImageCropper::Plugin::gen_thumbnails_start
      imagecropper_crop: $ImageCropper::ImageCropper::Plugin::crop
      imagecropper_delete_crop: $ImageCropper::ImageCropper::Plugin::delete_crop
    page_actions:
      asset:
        gen_thumbnails: 
          label: 'Generate Thumbnails'
          order: 100
          mode: manage_thumbnails
          permission: upload
          condition: $ImageCropper::ImageCropper::Util::asset_is_image
listing_screens:
  thumbnail_prototype:
    object_label: Crop Prototype
    object_label_plural: Crop Prototypes
    primary: label
    screen_label: Prototypes
    default_sort_key: label
    view:
      - blog
      - website
    scope_mode: this
list_properties:
  thumbnail_prototype:
    id:
      label: ID
      auto: 1
      order: 100
      display: optional
    label:
      label: Label
      auto: 1
      order: 200
      display: force
      html_link: >
        sub {
          my $prop = shift;
          my ( $obj, $app, $opts ) = @_;
          return $app->uri(
            mode => 'edit_prototype',
            args => {
              id => $obj->id,
              blog_id => $opts->{blog_id} || 0,
            },
          );
        }
    max_width:
      label: Max Width
      auto: 1
      display: default
      order: 300
    max_height:
      label: Max Height
      auto: 1
      display: default
      order: 400
    created_by:
      label: Created By
      base: __virtual.author_name
      display: optional
      order: 500
    created_on:
      label: Created On
      auto: 1
      display: optional
      order: 600
list_actions:
  thumbnail_prototype:
    delete:
      label: Delete
      code: Common::delete
      mode: delete
      order: 100
      js_message: delete
      button: 1
content_actions:
  thumbnail_prototype:
    create_prototype:
      class: icon-create mt-open-dialog
      label: Create Crop Prototype
      mode: edit_prototype
      order: 200
